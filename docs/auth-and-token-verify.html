<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AWS Cognitoèªè¨¼ãƒ‡ãƒ¢ - èªè¨¼ï¼†IDãƒˆãƒ¼ã‚¯ãƒ³ã®ç¢ºèª</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <!--
      â€» ãƒ¡ãƒ¢
      @aws-sdk ã® URL ã« ?bundle ã‚’ä»˜ã‘ã¦ã„ã‚‹ç†ç”±ï¼š
      esm.sh ã‚„ skypack ç­‰ã® CDN ã¯ Node.js å‘ã‘ã‚³ãƒ¼ãƒ‰ã‚‚å«ã¾ã‚Œã‚‹
      ãƒ–ãƒ©ã‚¦ã‚¶ã§ãã®ã¾ã¾ä½¿ã†ã¨å†…éƒ¨ã§ Node.js ã® fs ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‘¼ã¼ã†ã¨ã—ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹
      Uncaught (in promise) Error: [unenv] fs.readFile is not implemented yet!
      ?bundle ã‚’ä»˜ã‘ã‚‹ã“ã¨ã§ãƒ–ãƒ©ã‚¦ã‚¶å‘ã‘ã«ãƒãƒ³ãƒ‰ãƒ«ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ãŒæä¾›ã•ã‚Œã€Node.js ç”¨ã‚³ãƒ¼ãƒ‰ã®æ··å…¥ã‚’å›é¿ã§ãã‚‹
      å‚è€ƒï¼šhttps://esm.sh/#bundle
    -->
    <script type="importmap">
      {
        "imports": {
          "@aws-sdk/client-cognito-identity-provider": "https://esm.sh/@aws-sdk/client-cognito-identity-provider@3.835.0?bundle",
          "amazon-cognito-identity-js": "https://esm.sh/amazon-cognito-identity-js@6.3.15?bundle",
          "jwt-decode": "https://esm.sh/jwt-decode@4.0.0"
        }
      }
    </script>
  </head>
  <body
    class="bg-gradient-to-br from-slate-50 to-slate-200 min-h-screen py-8 px-4"
  >
    <div class="max-w-4xl mx-auto space-y-8">
      <div class="bg-white rounded-xl shadow-lg p-8 text-center">
        <h1 class="text-3xl font-bold text-gray-800 mb-3">
          ğŸ” AWS Cognitoèªè¨¼ãƒ‡ãƒ¢
        </h1>
        <p class="text-gray-600 text-lg leading-relaxed">
          Cognitoãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ãŸèªè¨¼ãƒ•ãƒ­ãƒ¼ã‚’æ¤œè¨¼ã—ã€<br />
          ã‚°ãƒ«ãƒ¼ãƒ—ã®IAMãƒ­ãƒ¼ãƒ«è¨­å®šã«ã‚ˆã‚‹JWTãƒˆãƒ¼ã‚¯ãƒ³ã¸ã®å½±éŸ¿ã‚’ç¢ºèªã§ãã¾ã™ã€‚<br />
          ã“ã®ç”»é¢ã§ã¯èªè¨¼ã«ã¤ã„ã¦ USER_PASSWORD_AUTH ã®ãƒ•ãƒ­ãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™<br />
          <span class="text-blue-600">
            â€» ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ Cognito è¨­å®šã¨èªè¨¼çŠ¶æ…‹ã‚’ç¶­æŒã—ã¾ã™
          </span>
        </p>
      </div>

      <!-- ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹è¡¨ç¤º -->
      <div
        id="sessionStatus"
        class="hidden bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl shadow-lg p-6 border-l-4 border-blue-500"
      >
        <div class="flex items-center gap-3">
          <span class="text-blue-500 text-xl">ğŸ”„</span>
          <span class="text-blue-800 font-medium"
            >ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰èªè¨¼çŠ¶æ…‹ã‚’å¾©å…ƒä¸­...</span
          >
        </div>
      </div>

      <div
        class="bg-gradient-to-r from-slate-50 to-blue-50 rounded-xl shadow-lg p-8 border-l-4 border-blue-500"
      >
        <h3
          class="text-xl font-semibold text-gray-800 cursor-pointer select-none flex items-center gap-2 hover:text-blue-600 transition-colors duration-200"
          onclick="toggleConfig()"
        >
          âš™ï¸ Cognitoè¨­å®š
          <span
            id="toggleIcon"
            class="text-blue-500 transform transition-transform duration-200"
            >â–¶</span
          >
        </h3>
        <div id="configInputs" class="mt-6 hidden">
          <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
            <div class="grid gap-6">
              <div>
                <label
                  for="region"
                  class="block text-sm font-semibold text-gray-700 mb-2"
                  >ãƒªãƒ¼ã‚¸ãƒ§ãƒ³:</label
                >
                <input
                  type="text"
                  id="region"
                  value="ap-northeast-1"
                  placeholder="ap-northeast-1"
                  class="w-full border-2 border-gray-300 p-3 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200"
                />
              </div>
              <div>
                <label
                  for="userPoolId"
                  class="block text-sm font-semibold text-gray-700 mb-2"
                  >ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«ID:</label
                >
                <input
                  type="text"
                  id="userPoolId"
                  placeholder="ap-northeast-1_XXXXXXXXX"
                  class="w-full border-2 border-gray-300 p-3 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200"
                />
              </div>
              <div>
                <label
                  for="clientId"
                  class="block text-sm font-semibold text-gray-700 mb-2"
                  >ã‚¢ãƒ—ãƒªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID:</label
                >
                <input
                  type="text"
                  id="clientId"
                  placeholder="ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID"
                  class="w-full border-2 border-gray-300 p-3 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200"
                />
              </div>
            </div>
            <button
              onclick="validateConfig()"
              class="mt-6 w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white py-3 px-6 rounded-lg font-semibold shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200"
            >
              è¨­å®šã‚’ç¢ºèª
            </button>
          </div>
        </div>
        <div
          id="configStatus"
          class="mt-6 text-amber-800 bg-gradient-to-r from-amber-50 to-yellow-50 p-4 rounded-lg border-l-4 border-amber-400 font-medium"
        >
          âš™ï¸ è¨­å®šã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
        </div>
      </div>

      <!-- ãƒ­ã‚°ã‚¤ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div
        class="hidden bg-gradient-to-r from-slate-50 to-indigo-50 rounded-xl shadow-lg p-8 border-l-4 border-indigo-500 transition-all duration-300"
        id="loginSection"
      >
        <h2
          class="text-xl font-semibold text-gray-800 mb-6 flex items-center gap-2"
        >
          ğŸ“§ ãƒ­ã‚°ã‚¤ãƒ³
        </h2>
        <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
          <div class="space-y-4">
            <div>
              <label
                for="email"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:
              </label>
              <input
                id="email"
                type="email"
                class="w-full border-2 border-gray-300 p-3 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200"
                placeholder="user@example.com"
              />
            </div>
            <div>
              <label
                for="password"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:
              </label>
              <input
                id="password"
                type="password"
                class="w-full border-2 border-gray-300 p-3 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200"
                placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›"
              />
            </div>
            <button
              onclick="signIn()"
              id="signInBtn"
              disabled
              class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white py-3 px-6 rounded-lg font-semibold shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200"
            >
              ãƒ­ã‚°ã‚¤ãƒ³
            </button>
            <div
              id="errorAlert"
              class="hidden text-red-700 bg-gradient-to-r from-red-50 to-pink-50 p-4 rounded-lg border-l-4 border-red-400 font-medium"
            ></div>
          </div>
        </div>
      </div>

      <!-- èªè¨¼å¾Œè¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div
        id="loggedInSection"
        class="hidden bg-gradient-to-r from-slate-50 to-indigo-50 rounded-xl shadow-lg p-8 border-l-4 border-emerald-500"
      >
        <div
          class="bg-gradient-to-r from-green-100 to-emerald-100 text-green-800 p-4 rounded-lg mb-6 border-l-4 border-green-400 font-semibold"
        >
          âœ… èªè¨¼æˆåŠŸ
          <span id="sessionRestored" class="hidden">
            ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰å¾©å…ƒï¼‰
          </span>
        </div>
        <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
          <h3 class="text-lg font-bold text-gray-800 mb-4">
            IDãƒˆãƒ¼ã‚¯ãƒ³ (ãƒ‡ã‚³ãƒ¼ãƒ‰æ¸ˆã¿):
          </h3>
          <pre
            id="idTokenDisplay"
            class="bg-gray-900 text-gray-100 p-6 rounded-lg overflow-x-auto text-sm font-mono border border-gray-300 shadow-inner"
          ></pre>
          <div class="mt-4 text-sm text-gray-600">
            <p>
              <strong>ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™:</strong> <span id="tokenExpiry"></span>
            </p>
          </div>
        </div>
        <button
          onclick="signOut()"
          class="mt-6 w-full bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white py-3 px-6 rounded-lg font-semibold shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200"
        >
          ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        </button>
      </div>

      <!-- æ¤œè¨¼ãƒã‚¤ãƒ³ãƒˆ -->
      <div
        class="bg-gradient-to-r from-slate-50 to-indigo-50 rounded-xl shadow-lg p-8 border-l-4 border-blue-500"
      >
        <h3
          class="text-xl font-semibold text-gray-800 mb-6 flex items-center gap-2"
        >
          ğŸ“‹ æ¤œè¨¼ãƒã‚¤ãƒ³ãƒˆ
        </h3>
        <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
          <ul class="space-y-4 text-gray-700">
            <li class="flex items-start gap-3">
              <span
                class="flex-shrink-0 w-2 h-2 bg-blue-500 rounded-full mt-2"
              ></span>
              <div>
                <strong class="text-blue-600">cognito:roles</strong> -
                ã‚°ãƒ«ãƒ¼ãƒ—ã«IAMãƒ­ãƒ¼ãƒ«ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã«è¡¨ç¤ºã•ã‚Œã‚‹é…åˆ—
              </div>
            </li>
            <li class="flex items-start gap-3">
              <span
                class="flex-shrink-0 w-2 h-2 bg-blue-500 rounded-full mt-2"
              ></span>
              <div>
                <strong class="text-blue-600">cognito:preferred_role</strong> -
                å„ªå…ˆçš„ã«ä½¿ç”¨ã™ã‚‹IAMãƒ­ãƒ¼ãƒ«ã®ARN
              </div>
            </li>
            <li class="flex items-start gap-3">
              <span
                class="flex-shrink-0 w-2 h-2 bg-red-500 rounded-full mt-2"
              ></span>
              <div>
                <strong class="text-red-600">å•é¡Œ:</strong>
                ä¸€åº¦è¨­å®šã™ã‚‹ã¨ç©ºã§ã®æ›´æ–°ãŒã§ããšã€å‰Šé™¤ã™ã‚‹ã«ã¯ã‚°ãƒ«ãƒ¼ãƒ—ã®å†ä½œæˆãŒå¿…è¦
              </div>
            </li>
            <li class="flex items-start gap-3">
              <span
                class="flex-shrink-0 w-2 h-2 bg-red-500 rounded-full mt-2"
              ></span>
              <div>ä¸è¦ãªå ´åˆã§ã‚‚ãƒˆãƒ¼ã‚¯ãƒ³ã«æ°¸ç¶šçš„ã«æ®‹ã‚Šç¶šã‘ã‚‹</div>
            </li>
            <li class="flex items-start gap-3">
              <span
                class="flex-shrink-0 w-2 h-2 bg-purple-500 rounded-full mt-2"
              ></span>
              <div>
                JWTãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚°ãƒ«ãƒ¼ãƒ—æƒ…å ±ã¨ãƒ­ãƒ¼ãƒ«è¨­å®šã‚’ç¢ºèªå¯èƒ½
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <script type="module">
      import {
        CognitoIdentityProviderClient,
        InitiateAuthCommand,
        GlobalSignOutCommand,
      } from "@aws-sdk/client-cognito-identity-provider";
      import { jwtDecode } from "jwt-decode";

      let cognitoClient = null;
      let currentUser = null;
      let config = { region: "", userPoolId: "", clientId: "" };

      // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã‚­ãƒ¼
      const SESSION_KEYS = {
        AUTH_DATA: "cognito_auth_data",
        CONFIG: "cognito_config",
      };

      // åˆæœŸåŒ–å‡¦ç†
      window.addEventListener("DOMContentLoaded", () => {
        restoreSession();
      });

      // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰èªè¨¼çŠ¶æ…‹ã‚’å¾©å…ƒ
      function restoreSession() {
        const sessionStatus = document.getElementById("sessionStatus");

        try {
          // è¨­å®šã‚’å¾©å…ƒ
          const savedConfig = sessionStorage.getItem(SESSION_KEYS.CONFIG);
          if (savedConfig) {
            config = JSON.parse(savedConfig);
            document.getElementById("region").value = config.region;
            document.getElementById("userPoolId").value = config.userPoolId;
            document.getElementById("clientId").value = config.clientId;

            // Cognitoã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åˆæœŸåŒ–
            cognitoClient = new CognitoIdentityProviderClient({
              region: config.region,
            });

            // è¨­å®šå®Œäº†çŠ¶æ…‹ã‚’è¡¨ç¤º
            updateConfigStatus(true);
          }

          // èªè¨¼ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
          const savedAuthData = sessionStorage.getItem(SESSION_KEYS.AUTH_DATA);
          if (savedAuthData && cognitoClient) {
            sessionStatus.classList.remove("hidden");

            const authData = JSON.parse(savedAuthData);

            // ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ã‚’ãƒã‚§ãƒƒã‚¯
            const decodedToken = jwtDecode(authData.IdToken);
            const currentTime = Math.floor(Date.now() / 1000);

            if (decodedToken.exp > currentTime) {
              // ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœ‰åŠ¹ãªå ´åˆã€èªè¨¼çŠ¶æ…‹ã‚’å¾©å…ƒ
              currentUser = authData;
              showLoggedInState(true);
              console.log("ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰èªè¨¼çŠ¶æ…‹ã‚’å¾©å…ƒã—ã¾ã—ãŸ");
            } else {
              // ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœŸé™åˆ‡ã‚Œã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢
              console.log("ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœŸé™åˆ‡ã‚Œã®ãŸã‚ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™");
              clearSession();
            }
          }
        } catch (error) {
          console.error("ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒã‚¨ãƒ©ãƒ¼:", error);
          clearSession();
        } finally {
          sessionStatus.classList.add("hidden");
        }
      }

      // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢
      function clearSession() {
        sessionStorage.removeItem(SESSION_KEYS.AUTH_DATA);
        currentUser = null;
      }

      // èªè¨¼ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜
      function saveAuthToSession(authData) {
        sessionStorage.setItem(
          SESSION_KEYS.AUTH_DATA,
          JSON.stringify(authData)
        );
      }

      // è¨­å®šã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜
      function saveConfigToSession(configData) {
        sessionStorage.setItem(SESSION_KEYS.CONFIG, JSON.stringify(configData));
      }

      // ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®çŠ¶æ…‹ã‚’è¡¨ç¤º
      function showLoggedInState(isRestored = false) {
        const decodedToken = jwtDecode(currentUser.IdToken);
        document.getElementById("idTokenDisplay").textContent = JSON.stringify(
          decodedToken,
          null,
          2
        );

        // æœ‰åŠ¹æœŸé™ã‚’è¡¨ç¤º
        const expiryDate = new Date(decodedToken.exp * 1000);
        document.getElementById("tokenExpiry").textContent =
          expiryDate.toLocaleString("ja-JP");

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒã®è¡¨ç¤º
        if (isRestored) {
          document.getElementById("sessionRestored").classList.remove("hidden");
        }

        document.getElementById("loginSection").classList.add("hidden");
        document.getElementById("loggedInSection").classList.remove("hidden");
      }

      // è¨­å®šçŠ¶æ…‹ã‚’æ›´æ–°
      function updateConfigStatus(isValid) {
        const loginSection = document.getElementById("loginSection");
        const statusDiv = document.getElementById("configStatus");
        const signInBtn = document.getElementById("signInBtn");

        if (isValid) {
          statusDiv.innerHTML = `
            <div class="flex items-center gap-2">
              <span class="text-green-500">âœ…</span>
              <span>è¨­å®šå®Œäº† - ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½ã§ã™</span>
            </div>
          `;
          statusDiv.className =
            "mt-6 text-green-800 bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg border-l-4 border-green-400 font-medium";

          // ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã§ãªã„å ´åˆã®ã¿ãƒ­ã‚°ã‚¤ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
          if (!currentUser) {
            loginSection.classList.remove("hidden");
          }
          signInBtn.disabled = false;
        } else {
          statusDiv.innerHTML = `
            <div class="flex items-center gap-2">
              <span class="text-red-500">âŒ</span>
              <span>å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</span>
            </div>
          `;
          statusDiv.className =
            "mt-6 text-red-800 bg-gradient-to-r from-red-50 to-pink-50 p-4 rounded-lg border-l-4 border-red-400 font-medium";
          loginSection.classList.add("hidden");
          signInBtn.disabled = true;
        }
      }

      window.toggleConfig = () => {
        const inputs = document.getElementById("configInputs");
        const icon = document.getElementById("toggleIcon");
        const isHidden = inputs.classList.toggle("hidden");
        icon.textContent = "â–¶";
        icon.style.transform = isHidden ? "rotate(0deg)" : "rotate(90deg)";
      };

      window.validateConfig = () => {
        config.region = document.getElementById("region").value.trim();
        config.userPoolId = document.getElementById("userPoolId").value.trim();
        config.clientId = document.getElementById("clientId").value.trim();

        if (!config.region || !config.userPoolId || !config.clientId) {
          updateConfigStatus(false);
          return;
        }

        cognitoClient = new CognitoIdentityProviderClient({
          region: config.region,
        });

        // è¨­å®šã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜
        saveConfigToSession(config);

        updateConfigStatus(true);

        // å…¥åŠ›æ¬„ã‚’é–‰ã˜ã‚‹
        document.getElementById("configInputs").classList.add("hidden");
        const icon = document.getElementById("toggleIcon");
        icon.textContent = "â–¶";
        icon.style.transform = "rotate(0deg)";
      };

      window.signIn = async () => {
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;
        const alertDiv = document.getElementById("errorAlert");

        if (!email || !password) {
          alertDiv.innerHTML = `
            <div class="flex items-center gap-2">
              <span class="text-red-500">âš ï¸</span>
              <span>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</span>
            </div>
          `;
          alertDiv.classList.remove("hidden");
          return;
        }

        try {
          const command = new InitiateAuthCommand({
            AuthFlow: "USER_PASSWORD_AUTH",
            ClientId: config.clientId,
            AuthParameters: { USERNAME: email, PASSWORD: password },
          });

          const response = await cognitoClient.send(command);
          currentUser = response.AuthenticationResult;

          // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜
          saveAuthToSession(currentUser);

          showLoggedInState(false);
          alertDiv.classList.add("hidden");

          console.log("ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ - ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜ã—ã¾ã—ãŸ");
        } catch (e) {
          alertDiv.innerHTML = `
            <div class="flex items-center gap-2">
              <span class="text-red-500">âŒ</span>
              <span>èªè¨¼ã‚¨ãƒ©ãƒ¼: ${e.message}</span>
            </div>
          `;
          alertDiv.classList.remove("hidden");
        }
      };

      window.signOut = async () => {
        if (currentUser && cognitoClient) {
          try {
            const command = new GlobalSignOutCommand({
              AccessToken: currentUser.AccessToken,
            });
            const response = await cognitoClient.send(command);
            console.log("signed out:", response);
          } catch (e) {
            console.error("sign out error:", e);
          }
        }

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢
        clearSession();

        document.getElementById("loggedInSection").classList.add("hidden");
        document.getElementById("loginSection").classList.remove("hidden");
        document.getElementById("sessionRestored").classList.add("hidden");

        console.log("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå®Œäº† - ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ");
      };
    </script>
  </body>
</html>
